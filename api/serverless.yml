service: iwanttoreadmore

app: iwanttoreadmore
org: haltakov

stage: dev
region: us-east-1

provider:
    name: aws
    runtime: python3.8
    cfnRole: arn:aws:iam::018469183656:role/IWTRMCloudFormationRole
    environment:
        VOTES_TABLE: ${self:service}-votes-${opt:stage, self:provider.stage}
    iamRoleStatements:
        - Effect: Allow
          Action:
              - dynamodb:Query
              - dynamodb:Scan
              - dynamodb:GetItem
              - dynamodb:PutItem
              - dynamodb:UpdateItem
              - dynamodb:DeleteItem
          Resource: "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.VOTES_TABLE}"

functions:
    vote:
        handler: iwanttoreadmore/handlers/vote.add_vote
        memorySize: 128
        events:
            - http:
                  path: vote/{user}/{project}/{topic}
                  method: post
                  cors: true
    vote_and_redirect:
        handler: iwanttoreadmore/handlers/vote.add_vote_and_redirect
        memorySize: 128
        events:
            - http:
                  path: vote/{user}/{project}/{topic}
                  method: get
                  cors: true
    get_votes_for_user:
        handler: iwanttoreadmore/handlers/vote.get_votes_for_user
        memorySize: 128
        events:
            - http:
                  path: votes/{user}
                  method: get
                  cors: true
    get_votes_for_project:
        handler: iwanttoreadmore/handlers/vote.get_votes_for_project
        memorySize: 128
        events:
            - http:
                  path: votes/{user}/{project}
                  method: get
                  cors: true

resources:
    Resources:
        IWTRMDynamoDbTable:
            Type: "AWS::DynamoDB::Table"
            DeletionPolicy: Retain
            Properties:
                AttributeDefinitions:
                    - AttributeName: User
                      AttributeType: S
                    - AttributeName: TopicKey
                      AttributeType: S
                KeySchema:
                    - AttributeName: User
                      KeyType: HASH
                    - AttributeName: TopicKey
                      KeyType: RANGE
                ProvisionedThroughput:
                    ReadCapacityUnits: 1
                    WriteCapacityUnits: 1
                TableName: ${self:provider.environment.VOTES_TABLE}
